[![Build](https://github.com/airbox-build/shipper/actions/workflows/release.yml/badge.svg)](https://github.com/airbox-build/shipper/actions/workflows/release.yml) [![Unit Test](https://github.com/airbox-build/shipper/actions/workflows/unit-test.yml/badge.svg)](https://github.com/airbox-build/shipper/actions/workflows/unit-test.yml)

# AirBox Shipper

The AirBox Shipper is responsible for shipping the logs generated by the AirBox Agent. Written in Go, it collects the JSON log files created by the AirBox Agent, aggregates them, and sends them to a designated API endpoint for further processing and analysis.

## Features

- **Batch Processing**: Reads and processes up to a configurable number of log files at once.
- **Configurable Parameters**: Easily configure file paths, API credentials, and processing intervals using a YAML configuration file.
- **Secure Data Transfer**: Uses API tokens and server keys to securely send data to the endpoint.
- **Automatic Cleanup**: Deletes processed files after successful transmission.

## Requirements

- **Go**: The AirBox Shipper is written in Go and requires Go to be installed for compilation.
- **Permissions**: The shipper needs permission to read the log files and delete them after processing.
- **Libraries**: The shipper uses standard Go libraries. You can install the dependencies with:

  ```sh
  go mod tidy
  ```

## Installation

### Install via Bash Script (Linux & Mac)

Linux & Mac users can install it directly to `/usr/local/bin/airbox-shipper` with:

```bash
sudo bash < <(curl -sL https://raw.githubusercontent.com/airbox-build/shipper/main/install)
```

### Download Static Binary (Windows, Linux, and Mac)

Run the following command which will download the latest version and configure default settings for Windows:

```batch
powershell -command "(New-Object Net.WebClient).DownloadFile('https://raw.githubusercontent.com/airbox-build/shipper/main/install.ps1', '%TEMP%\install.ps1') && %TEMP%\install.ps1 && del %TEMP%\install.ps1"
```

## Usage

The AirBox Shipper continuously monitors a directory for new JSON log files, aggregates the data, and sends it to an API endpoint at configurable intervals.

### Command-Line Flags

- `--config`: Specifies the path to the configuration file (default is `/etc/airbox/shipper.yml`).

### Configuration File (`shipper.yml`)

The shipper is configured using a YAML file that includes the following parameters:

```yaml
path_pattern: "/var/log/airbox/*.json"  # Path pattern to specify the location of JSON files to be processed.
max_files: 60                             # Maximum number of files to process at one time.
api_endpoint: "https://api.example.com/endpoint"  # The API endpoint to which the payload will be sent.
api_token: "YOUR_API_TOKEN"              # The API token required for authenticating with the API endpoint.
server_key: "YOUR_SERVER_KEY"            # The server key used to secure the connection to the API endpoint.
check_interval: 10s                       # Interval at which the app should check for new files.
```

### Example Usage

To start the shipper with a custom configuration file:

```sh
go run main.go --config /path/to/your/config.yml
```

## Customization

- **Log Directory**: You can change the log directory by editing the `path_pattern` in the configuration file.
- **Batch Size**: The default batch size is 60 files. You can adjust this by modifying `max_files` in the configuration.
- **Collection Frequency**: Adjust the `check_interval` parameter to control how often the shipper checks for new log files.

## License

This project is licensed under the MIT License.

## Contributing

Contributions are welcome! Feel free to open issues or submit pull requests to improve the functionality or add new features.

## Security Vulnerabilities

If you discover a security vulnerability within AirBox, please send an e-mail to Nasrul Hazim via [nasrulhazim.m@gmail.com](mailto:nasrulhazim.m@gmail.com). All security vulnerabilities will be promptly addressed.

## Contributors

<a href="https://github.com/airbox-build/shipper/graphs/contributors">
  <img src="https://contrib.rocks/image?repo=airbox-build/shipper"  alt="AirBox Contributors"/>
</a>

